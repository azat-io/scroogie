pipeline {
  agent any
  environment {
    APP_URL = credentials('scroogie-app-url')
    APP_PORT = credentials('scroogie-app-port')
    DATABASE_HOST = credentials('scroogie-database-host')
    DATABASE_NAME = credentials('scroogie-database-name')
    DATABASE_USER = credentials('scroogie-database-user')
    DATABASE_PASSWORD = credentials('scroogie-database-password')
    GIPHY_API_KEY = credentials('scroogie-giphy-api-key')
    TELEGRAM_BOT_TOKEN = credentials('scroogie-telegram-bot-token')
    TELEGRAM_USERS = credentials('scroogie-telegram-users')
  }
  stages {
    stage('Lint') {
      steps {
        sh 'make lint'
      }
    }
    stage('Test') {
      steps {
        sh 'make test'
      }
    }
    stage('Deploy') {
      steps {
        sh 'docker-compose up'
      }
    }
  }
}
